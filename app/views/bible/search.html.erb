<% content_for :title, "B√∫squeda - Biblia Interlineal" %>

<div class="space-y-6 lg:space-y-8">
  <!-- Search Header -->
  <div class="bg-gray-800 rounded-lg lg:rounded-xl p-6 lg:p-8 border border-gray-700">
    <h1 class="text-2xl lg:text-4xl xl:text-5xl font-bold text-yellow-400 text-center mb-6 lg:mb-8">
      üîç B√∫squeda en las Escrituras
    </h1>

    <!-- Search Form -->
    <%= form_with url: bible_search_path, method: :get, local: true,
        class: "space-y-4 lg:space-y-6",
        data: {
          controller: "search",
          action: "submit->search#submit keydown@document->search#keydown"
        } do |f| %>
      <div class="flex flex-col lg:flex-row gap-3 lg:gap-4">
        <%= text_field_tag :q, @query,
            {
              class: "flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 lg:px-6 py-3 lg:py-4 text-base lg:text-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400",
              placeholder: t('search.placeholder'),
              autocomplete: "off",
              autofocus: true,
              data: { search_target: "input" }
            } %>
        <%= submit_tag "üîç #{t('search.button')}",
            class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 lg:px-8 py-3 lg:py-4 rounded-lg text-base lg:text-xl transition-colors duration-200 min-w-32" %>
      </div>
    <% end %>

    <!-- Search Tips -->
    <div class="mt-6 lg:mt-8 p-4 lg:p-6 bg-gray-700 rounded-lg border border-gray-600">
      <h3 class="text-lg lg:text-xl font-semibold text-white mb-3 lg:mb-4">üí° Consejos de B√∫squeda</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4 text-sm lg:text-base text-gray-300">
        <div>
          <strong class="text-yellow-400">Espa√±ol:</strong> amor, fe, esperanza
        </div>
        <div>
          <strong class="text-sky-300">Griego:</strong> ·ºÄŒ≥Œ¨œÄŒ∑, ŒªœåŒ≥ŒøœÇ, Œ∏ŒµœåœÇ
        </div>
        <div>
          <strong class="text-green-400">Strong's:</strong> G26, G3056, G2316
        </div>
      </div>
    </div>
  </div>

  <!-- Search Results -->
  <% if @query.present? %>
    <div class="bg-gray-800 rounded-lg lg:rounded-xl p-6 lg:p-8 border border-gray-700">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 lg:gap-6 mb-6 lg:mb-8">
        <h2 class="text-xl lg:text-2xl font-bold text-white">
          Resultados para: "<span class="text-yellow-400"><%= h(@query) %></span>"
        </h2>

        <% if @results.present? %>
          <div class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm lg:text-base font-semibold">
            <%= @total_results %> <%= @total_results == 1 ? 'resultado' : 'resultados' %>
          </div>
        <% end %>
      </div>

      <% if @results.present? %>
        <!-- Results Grid -->
        <div class="space-y-4 lg:space-y-6">
          <% @results.each_with_index do |verse, index| %>
            <div class="bg-gray-700 hover:bg-blue-600 rounded-lg p-4 lg:p-6 transition-all duration-300 transform hover:scale-105 border border-gray-600 hover:border-blue-400 group">
              <div class="flex items-start gap-4">
                <!-- Result Number -->
                <div class="flex-shrink-0">
                  <span class="bg-yellow-600 group-hover:bg-yellow-500 text-yellow-100 font-bold text-sm lg:text-base w-8 h-8 lg:w-10 lg:h-10 rounded-full flex items-center justify-center">
                    <%= index + 1 %>
                  </span>
                </div>

                <!-- Verse Content -->
                <div class="flex-1 min-w-0">
                  <!-- Verse Reference -->
                  <h3 class="text-lg lg:text-xl font-bold text-yellow-400 mb-2 lg:mb-3">
                    <%= verse.full_reference %>
                  </h3>

                  <!-- Spanish Text with Search Highlighting -->
                  <% if verse.spanish_text.present? %>
                    <p class="text-base lg:text-lg xl:text-xl text-white leading-relaxed mb-4 lg:mb-6">
                      <% if @query.present? %>
                        <%= highlight(verse.spanish_text, h(@query), highlighter: '<mark class="bg-yellow-400 text-black px-1 rounded font-semibold">\1</mark>').html_safe %>
                      <% else %>
                        <%= verse.spanish_text %>
                      <% end %>
                    </p>
                  <% end %>

                  <!-- Matching Words Info -->
                  <% matching_words = verse.words.where("greek_word LIKE ? OR spanish_translation LIKE ? OR strong_number LIKE ?", "%#{@query}%", "%#{@query}%", "%#{@query}%") %>
                  <% if matching_words.present? %>
                    <div class="mb-4 lg:mb-6">
                      <h4 class="text-sm lg:text-base font-semibold text-sky-300 mb-2">
                        üî§ Palabras coincidentes:
                      </h4>
                      <div class="flex flex-wrap gap-2">
                        <% matching_words.each do |word| %>
                          <span class="bg-sky-600 text-white px-2 py-1 rounded text-xs lg:text-sm font-medium">
                            <%= word.greek_word.present? ? word.greek_word : word.spanish_translation %>
                            <% if word.strong_number.present? %>
                              (G<%= word.strong_number %>)
                            <% end %>
                          </span>
                        <% end %>
                      </div>
                    </div>
                  <% end %>

                  <!-- Action Buttons -->
                  <div class="flex flex-col sm:flex-row gap-2 lg:gap-3">
                    <%= link_to "üìñ Ver Vers√≠culo",
                        bible_verse_path(verse.book.id, verse.chapter.chapter_number, verse.verse_number),
                        class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 lg:px-4 py-2 rounded-lg text-sm lg:text-base transition-colors duration-200 text-center flex-1" %>

                    <%= link_to "üìë Ver Cap√≠tulo",
                        bible_chapter_path(verse.book.id, verse.chapter.chapter_number),
                        class: "bg-gray-600 hover:bg-gray-500 text-white font-semibold px-3 lg:px-4 py-2 rounded-lg text-sm lg:text-base transition-colors duration-200 text-center flex-1" %>

                    <%= link_to "üì∫ Slideshow",
                        bible_slideshow_path(verse.book.id, verse.chapter.chapter_number, verse.verse_number),
                        class: "bg-green-600 hover:bg-green-700 text-white font-semibold px-3 lg:px-4 py-2 rounded-lg text-sm lg:text-base transition-colors duration-200 text-center flex-1",
                        target: "_blank",
                        title: "Abrir en modo presentaci√≥n" %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Search Stats -->
        <div class="mt-8 lg:mt-12 p-4 lg:p-6 bg-gray-700 rounded-lg border border-gray-600">
          <h3 class="text-lg lg:text-xl font-semibold text-white mb-3 lg:mb-4">üìä Estad√≠sticas de B√∫squeda</h3>

          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 text-center">
            <div>
              <div class="text-xl lg:text-2xl font-bold text-yellow-400 mb-1">
                <%= @total_results %>
              </div>
              <div class="text-sm lg:text-base text-gray-400">
                <%= @total_results == 1 ? 'Vers√≠culo' : 'Vers√≠culos' %>
              </div>
            </div>

            <div>
              <div class="text-xl lg:text-2xl font-bold text-sky-400 mb-1">
                <%= @results.map(&:book).uniq.count %>
              </div>
              <div class="text-sm lg:text-base text-gray-400">
                <%= @results.map(&:book).uniq.count == 1 ? 'Libro' : 'Libros' %>
              </div>
            </div>

            <div>
              <div class="text-xl lg:text-2xl font-bold text-green-400 mb-1">
                <%= @results.map { |v| v.chapter }.uniq.count %>
              </div>
              <div class="text-sm lg:text-base text-gray-400">
                <%= @results.map { |v| v.chapter }.uniq.count == 1 ? 'Cap√≠tulo' : 'Cap√≠tulos' %>
              </div>
            </div>

            <div>
              <div class="text-xl lg:text-2xl font-bold text-purple-400 mb-1">
                <%= @results.sum { |v| v.words.where("greek_word LIKE ? OR spanish_translation LIKE ? OR strong_number LIKE ?", "%#{@query}%", "%#{@query}%", "%#{@query}%").count } %>
              </div>
              <div class="text-sm lg:text-base text-gray-400">
                Coincidencias
              </div>
            </div>
          </div>
        </div>

      <% elsif @query.length < 2 %>
        <!-- Query too short -->
        <div class="text-center py-12 lg:py-20">
          <div class="text-6xl lg:text-8xl mb-6">‚ö†Ô∏è</div>
          <h3 class="text-xl lg:text-3xl font-semibold text-white mb-4">
            B√∫squeda muy corta
          </h3>
          <p class="text-base lg:text-xl text-gray-400">
            Por favor, ingrese al menos 2 caracteres para realizar la b√∫squeda.
          </p>
        </div>

      <% else %>
        <!-- No results -->
        <div class="text-center py-12 lg:py-20">
          <div class="text-6xl lg:text-8xl mb-6">üòî</div>
          <h3 class="text-xl lg:text-3xl font-semibold text-white mb-4">
            No se encontraron resultados
          </h3>
          <p class="text-base lg:text-xl text-gray-400 mb-8">
            No hay vers√≠culos que coincidan con "<span class="text-yellow-400"><%= h(@query) %></span>".
          </p>

          <!-- Search Suggestions -->
          <div class="bg-gray-700 rounded-lg p-4 lg:p-6 max-w-2xl mx-auto">
            <h4 class="text-lg lg:text-xl font-semibold text-white mb-3">üí° Sugerencias:</h4>
            <ul class="text-sm lg:text-base text-gray-300 space-y-2 text-left">
              <li>‚Ä¢ Verifique la ortograf√≠a de las palabras</li>
              <li>‚Ä¢ Intente con palabras m√°s generales</li>
              <li>‚Ä¢ Use palabras clave en lugar de frases completas</li>
              <li>‚Ä¢ Pruebe b√∫squedas en griego usando caracteres griegos</li>
              <li>‚Ä¢ Busque n√∫meros Strong con formato G1234</li>
            </ul>
          </div>
        </div>
      <% end %>
    </div>

  <% else %>
    <!-- Welcome State -->
    <div class="bg-gray-800 rounded-lg lg:rounded-xl p-6 lg:p-8 border border-gray-700">
      <div class="text-center py-12 lg:py-20">
        <div class="text-6xl lg:text-8xl mb-6">üîç</div>
        <h2 class="text-2xl lg:text-4xl font-bold text-white mb-6 lg:mb-8">
          B√∫squeda Avanzada
        </h2>
        <p class="text-base lg:text-xl text-gray-400 mb-8 lg:mb-12 max-w-3xl mx-auto leading-relaxed">
          Encuentre vers√≠culos espec√≠ficos buscando por palabras en espa√±ol, t√©rminos griegos originales, o n√∫meros de Strong's Concordance.
          Perfecto para estudios b√≠blicos profundos y preparaci√≥n de sermones.
        </p>

        <!-- Popular Searches -->
        <div class="max-w-4xl mx-auto">
          <h3 class="text-xl lg:text-2xl font-semibold text-yellow-400 mb-4 lg:mb-6">
            üî• B√∫squedas Populares
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">
            <% popular_searches = ["amor", "fe", "esperanza", "paz", "gozo", "gracia", "salvaci√≥n", "vida eterna", "perd√≥n"] %>
            <% popular_searches.each do |search_term| %>
              <a href="<%= bible_search_path(q: search_term) %>"
                 class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-3 rounded-lg text-sm lg:text-base transition-colors duration-200 text-center">
                üîç <%= search_term.titleize %>
              </a>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Back to Home -->
  <div class="text-center">
    <%= link_to "üè† Volver al Inicio", root_path,
        class: "bg-gray-600 hover:bg-gray-500 text-white font-semibold px-6 lg:px-8 py-3 lg:py-4 rounded-lg text-base lg:text-xl transition-colors duration-200" %>
  </div>
</div>

<!-- All search functionality is now handled by Stimulus controller -->
