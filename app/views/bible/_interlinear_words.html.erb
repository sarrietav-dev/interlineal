<!-- Interlinear Words Display - Advanced Responsive System for Mobile to 4K -->
<%
  # Use passed config or create default for backwards compatibility
  config ||= InterlinearConfig.new(
    show_greek: settings&.fetch('show_greek', true) || true,
    show_hebrew: settings&.fetch('show_hebrew', true) || true,
    show_spanish: settings&.fetch('show_spanish', true) || true,
    show_strongs: settings&.fetch('show_strongs', true) || true,
    show_grammar: settings&.fetch('show_grammar', true) || true,
    show_pronunciation: settings&.fetch('show_pronunciation', false) || false,
    show_word_order: settings&.fetch('show_word_order', false) || false
  )
  
  # Use config settings or fallback to legacy settings
  settings ||= config.complete_settings_hash
%>

<div id="interlinear-words" 
     class="interlinear-grid mt-6 lg:mt-8"
     style="gap: <%= config.card_spacing * 0.01 %>rem; --card-padding-multiplier: <%= config.card_padding * 0.01 %>;"
     data-theme="<%= config.card_theme %>">
  <% words.each_with_index do |word, word_index| %>
    <div class="interlinear-word group bg-gray-700 hover:bg-blue-600 rounded-lg text-center transition-all duration-300 cursor-pointer transform hover:scale-105 hover:shadow-lg border border-gray-600 hover:border-blue-400 min-h-[120px] flex flex-col justify-between"
         style="padding: calc(var(--card-padding-multiplier, 1) * 0.75rem);"
         <% if word.strong_number.present? %>
           title="<%= t('tv.strongs_help') %>"
           tabindex="0"
         <% else %>
           title="<%= t('messages.no_data') %>"
         <% end %>>

      <!-- Main language elements arranged according to config -->
      <div class="main-elements space-y-2 flex-1">
        <% config.arranged_word_elements(word).each do |element| %>
          <div class="<%= element[:type] %>-word flex items-center justify-center">
            <% if element[:type] != 'spanish' && word.strong_number.present? %>
              <%= link_to strong_definition_path(word.strong_number),
                  class: "block font-medium #{element[:color_class]} leading-tight hover:opacity-80 transition-colors duration-200 break-words hyphens-auto",
                  style: "font-size: #{element[:font_size]}%; line-height: 1.2;",
                  data: { turbo_frame: "strong-definition-modal" },
                  title: "Ver definiciÃ³n Strong's" do %>
                <%= element[:text] %>
              <% end %>
            <% else %>
              <span class="block font-medium <%= element[:color_class] %> leading-tight break-words hyphens-auto"
                    style="font-size: <%= element[:font_size] %>%; line-height: 1.2;">
                <%= element[:text] %>
              </span>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Strong's Number and Grammar -->
      <div class="metadata space-y-1 mt-auto">
        <% if settings['show_strongs'] && word.strong_number.present? %>
          <div class="strong-number">
            <span class="inline-block bg-yellow-600 text-yellow-100 font-semibold px-2 py-1 rounded-md leading-none"
                  style="font-size: <%= config.strongs_font_size %>%;">
              <%= word.display_strong %>
            </span>
          </div>
        <% end %>

        <% if settings['show_grammar'] %>
          <% if word.greek_grammar.present? %>
            <div class="grammar">
              <span class="inline-block bg-gray-600 text-gray-200 font-normal px-2 py-1 rounded-md leading-none"
                    style="font-size: <%= config.grammar_font_size %>%;">
                <%= word.greek_grammar.truncate(10) %>
              </span>
            </div>
          <% elsif word.hebrew_grammar.present? %>
            <div class="grammar">
              <span class="inline-block bg-orange-600 text-orange-100 font-normal px-2 py-1 rounded-md leading-none"
                    style="font-size: <%= config.grammar_font_size %>%;">
                <%= word.hebrew_grammar.truncate(10) %>
              </span>
            </div>
          <% end %>
        <% end %>

        <% if settings['show_pronunciation'] && word.strong&.pronunciation.present? %>
          <div class="pronunciation">
            <span class="inline-block bg-purple-600 text-purple-100 font-normal px-2 py-1 rounded-md leading-none"
                  style="font-size: <%= config.pronunciation_font_size %>%;">
              /<%= word.strong.pronunciation %>/
            </span>
          </div>
        <% end %>
      </div>

      <!-- Word Order -->
      <% if settings['show_word_order'] %>
        <div class="word-order mt-2">
          <span class="text-gray-500 font-mono" style="font-size: 80%;">
            #<%= word.word_order %>
          </span>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<!-- Empty state if no words -->
<% if words.empty? %>
  <div class="text-center py-12 lg:py-16">
    <div class="text-gray-400 text-lg lg:text-2xl">
      <p class="mb-4"><%= t('messages.no_interlinear') %></p>
      <p class="text-base lg:text-xl"><%= t('messages.spanish_only') %></p>
    </div>
  </div>
<% end %>

<style>
  /* ==========================================
     ADVANCED RESPONSIVE INTERLINEAR SYSTEM
     Mobile (320px) to 4K+ (3840px+) Support
     ========================================== */

  /* Base interlinear grid system */
  .interlinear-grid {
    display: grid;
    gap: clamp(0.5rem, 2vw, 3rem);
    grid-template-columns: repeat(auto-fit, minmax(min(100%, max(120px, 15vw)), 1fr));
    align-items: start;
    justify-content: center;
    max-width: 100%;
    margin: 0 auto;
  }

  /* Theme variations */
  .interlinear-grid[data-theme="compact"] {
    gap: clamp(0.25rem, 1vw, 1.5rem);
  }

  .interlinear-grid[data-theme="compact"] .interlinear-word {
    min-height: clamp(80px, 10vh, 160px);
  }

  .interlinear-grid[data-theme="spacious"] {
    gap: clamp(1rem, 3vw, 4rem);
  }

  .interlinear-grid[data-theme="spacious"] .interlinear-word {
    min-height: clamp(140px, 15vh, 240px);
  }

  /* Base interlinear word styling with viewport-relative sizing */
  .interlinear-word {
    min-width: clamp(120px, 15vw, 350px);
    max-width: clamp(200px, 25vw, 500px);
    width: 100%;
    min-height: clamp(100px, 12vh, 200px);
    padding: clamp(0.5rem, 1.5vw, 2rem);
    border-radius: clamp(0.5rem, 1vw, 1.5rem);
    border-width: clamp(1px, 0.2vw, 3px);
    
    /* Enhanced focus for TV accessibility */
    transition: all 0.3s ease, outline 0.1s ease;
  }

  .interlinear-word:focus {
    outline: clamp(2px, 0.4vw, 6px) solid #fbbf24;
    outline-offset: clamp(2px, 0.3vw, 4px);
    transform: scale(1.05);
  }

  /* Dynamic font scaling system */
  .greek-word span {
    font-size: clamp(0.875rem, 3.5vw, 4rem);
    line-height: 1.2;
    font-weight: 500;
  }

  .hebrew-word span {
    font-size: clamp(0.875rem, 3.5vw, 4rem);
    line-height: 1.2;
    font-weight: 500;
  }

  .spanish-word span {
    font-size: clamp(0.75rem, 2.8vw, 3.2rem);
    line-height: 1.3;
    font-weight: 400;
  }

  .strong-number span,
  .grammar span {
    font-size: clamp(0.625rem, 1.8vw, 1.8rem);
    padding: clamp(0.25rem, 0.8vw, 1rem) clamp(0.5rem, 1.2vw, 1.5rem);
    border-radius: clamp(0.25rem, 0.5vw, 0.75rem);
  }

  .pronunciation span {
    font-size: clamp(0.625rem, 1.6vw, 1.6rem);
    padding: clamp(0.25rem, 0.8vw, 1rem) clamp(0.5rem, 1.2vw, 1.5rem);
    border-radius: clamp(0.25rem, 0.5vw, 0.75rem);
  }

  .word-order span {
    font-size: clamp(0.5rem, 1.2vw, 1.2rem);
  }

  /* ==========================================
     RESPONSIVE BREAKPOINTS
     ========================================== */

  /* Mobile Portrait (320px - 480px) */
  @media (max-width: 480px) and (orientation: portrait) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 0.5rem;
      padding: 0 0.5rem;
    }
    
    .interlinear-word {
      min-height: 90px;
      padding: 0.5rem;
    }
  }

  /* Mobile Landscape (481px - 767px) */
  @media (min-width: 481px) and (max-width: 767px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 0.75rem;
    }
  }

  /* Tablet Portrait (768px - 1023px) */
  @media (min-width: 768px) and (max-width: 1023px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
  }

  /* Desktop/Laptop (1024px - 1365px) */
  @media (min-width: 1024px) and (max-width: 1365px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 1.25rem;
    }
  }

  /* Large Desktop (1366px - 1919px) */
  @media (min-width: 1366px) and (max-width: 1919px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 1.5rem;
    }
  }

  /* Full HD/1080p (1920px - 2559px) */
  @media (min-width: 1920px) and (max-width: 2559px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.75rem;
      max-width: 95vw;
    }
    
    .interlinear-word {
      min-height: clamp(140px, 14vh, 180px);
    }
  }

  /* 2K/QHD (2560px - 3199px) */
  @media (min-width: 2560px) and (max-width: 3199px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 2rem;
      max-width: 92vw;
    }
    
    .interlinear-word {
      min-height: clamp(160px, 15vh, 200px);
      border-radius: 1rem;
    }
  }

  /* Ultrawide/3440x1440 (3200px - 3839px) */
  @media (min-width: 3200px) and (max-width: 3839px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2.5rem;
      max-width: 90vw;
    }
    
    .interlinear-word {
      min-height: clamp(180px, 16vh, 220px);
      border-radius: 1.25rem;
    }
  }

  /* 4K and beyond (3840px+) */
  @media (min-width: 3840px) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 3rem;
      max-width: 88vw;
    }
    
    .interlinear-word {
      min-height: clamp(200px, 18vh, 250px);
      border-radius: 1.5rem;
      border-width: 3px;
    }
    
    /* Enhanced font sizes for 4K+ viewing distance */
    .greek-word span,
    .hebrew-word span {
      font-size: clamp(2.5rem, 4vw, 5rem);
      font-weight: 600;
    }
    
    .spanish-word span {
      font-size: clamp(2rem, 3.2vw, 4rem);
      font-weight: 500;
    }
    
    .strong-number span,
    .grammar span {
      font-size: clamp(1.2rem, 2vw, 2.5rem);
      padding: 1rem 1.5rem;
    }
  }

  /* ==========================================
     ASPECT RATIO OPTIMIZATIONS
     ========================================== */

  /* Ultra-wide screens (21:9, 32:9 etc.) */
  @media (min-aspect-ratio: 2.1/1) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(calc(100vw / 12), 1fr));
      max-width: 95vw;
    }
  }

  /* Very tall screens or rotated displays */
  @media (max-aspect-ratio: 0.8/1) {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(calc(100vw / 3), 1fr));
      gap: clamp(1rem, 3vh, 2rem);
    }
    
    .interlinear-word {
      min-height: clamp(80px, 8vh, 120px);
    }
  }

  /* ==========================================
     ACCESSIBILITY & QUALITY ENHANCEMENTS
     ========================================== */

  /* High contrast mode for better TV visibility */
  @media (prefers-contrast: high) {
    .interlinear-word {
      border-width: clamp(2px, 0.3vw, 4px);
      border-color: #ffffff;
      background-color: #000000;
    }
    
    .greek-word span,
    .hebrew-word span {
      color: #ffffff;
      font-weight: 700;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
    
    .spanish-word span {
      color: #ffffff;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
  }

  /* Reduced motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .interlinear-word {
      transition: none;
    }
    
    .interlinear-word:hover {
      transform: none;
    }
  }

  /* Enhanced text handling for all languages */
  .greek-word span,
  .hebrew-word span,
  .spanish-word span {
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    text-align: center;
    display: block;
    width: 100%;
  }

  /* Improved spacing and layout */
  .greek-word,
  .hebrew-word,
  .spanish-word {
    max-width: 100%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .metadata {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: clamp(0.25rem, 0.5vw, 0.75rem);
    margin-top: auto;
  }

  /* Print media optimization */
  @media print {
    .interlinear-grid {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      page-break-inside: avoid;
    }
    
    .interlinear-word {
      min-height: 120px;
      page-break-inside: avoid;
      border: 1px solid #000;
    }
  }

  /* ==========================================
     RESPONSIVE TEXT ELEMENTS FOR REGULAR VIEWS
     ========================================== */
  
  .responsive-verse-title {
    font-size: clamp(1.5rem, 5vw, 4rem);
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: clamp(-0.02em, 0.05vw, 0.01em);
    text-shadow: clamp(1px, 0.2vw, 3px) clamp(1px, 0.2vw, 3px) clamp(1px, 0.3vw, 6px) rgba(0,0,0,0.5);
  }
  
  .responsive-spanish-text {
    font-size: clamp(1rem, 3vw, 2.5rem);
    line-height: clamp(1.4, 1.6, 1.8);
    text-align: justify;
    letter-spacing: clamp(-0.01em, 0.02vw, 0.005em);
  }

  /* ==========================================
     CONTAINER QUERIES (Future-proofing)
     ========================================== */
  
  /* When browser support improves, this will provide even better responsiveness */
  @supports (container-type: inline-size) {
    .interlinear-container {
      container-type: inline-size;
    }
    
    @container (min-width: 800px) {
      .interlinear-grid {
        grid-template-columns: repeat(auto-fit, minmax(min(25cqi, 300px), 1fr));
      }
    }
  }
</style>
